/* /////////////////////////////////////////////////////
 * YouTube Type Loader for ddGM
 * v 1.0 :: 2012-10-02
//////////////////////////////////////////////////////*/
(function(){var b="youtube",a={autoPlay:false,playnext:false,autoPin:true,APIThumb:"default",APIParams:{}},c={initialize:function(e){var d=this;d.opt.types[b]=$.extend(a,d.opt.types[b]);if(d.opt.types[b].APIParams.wmode==undefined){d.opt.types[b].APIParams.wmode="opaque"}if(typeof window.onYouTubeIframeAPIReady!="function"){$.ajax({url:"//www.youtube.com/iframe_api",type:"GET",dataType:"script"});d.registerEvent("postAnim",b,"changeItem","type");if(d.opt.types[b].autoPlay||d.opt.types[b].playnext){d.registerEvent("changeEnd",b,"autoPlay","type")}window.onYouTubeIframeAPIReady=function(){e.resolve()}}else{e.resolve()}},selector:function(f,g){var d=this,h,e;if(f.is("iframe")||(f.is("div")&&f.data("type")=="youtube")){g.video=f.is("iframe")?window.ddGM.types[b].setVideo.call(d,f.attr("src")):f.data("video");if(g.video){g.thumb=window.ddGM.types[b].setThumb.call(d,f.data("thumb"),g.video);h=f.attr("title")==undefined?f.data("title"):f.attr("title");window.ddGM.types[b].setText.call(d,{title:h,cap:f.data("caption")},g)}else{return false}}else{if(f.is("ul")&&f.data("type")=="youtube"){g.video=window.ddGM.types[b].setVideo.call(d,f.children('[data-item="content"]').children("iframe").attr("src"));if(g.video){g.extended=(f.children('[data-item="extended"]').length>0)?f.children('[data-item="extended"]').html():"";g.thumb=window.ddGM.types[b].setThumb.call(d,f.data("thumb"),g.video);e=(f.children('[data-item="caption"]').length>0)?f.children('[data-item="caption"]').html():"";h=f.children('[data-item="content"]').children("iframe").attr("title")||"";window.ddGM.types[b].setText.call(d,{title:h,cap:e},g)}else{return false}}else{return false}}return true},setVideo:function(e){var d=e.match(/(?:http\:|)\/\/(?:www\.|)(youtube)\.co(?:m|\.[a-zA-Z]{2}|)\/.*(?:v=|video\/|embed\/)(.{11})/i)||["","",""];if(d[1].toLowerCase()=="youtube"){return d[2]}else{return false}},setThumb:function(e,f){var d=this,g=["default","hqdefault","mqdefault","maxresdefault","0","1","2","3"];if(e==undefined){return"//img.youtube.com/vi/"+f+"/"+d.opt.types[b].APIThumb+".jpg"}else{if($.inArray(e.toString(),g)>=0){return"//img.youtube.com/vi/"+f+"/"+e+".jpg"}else{return e||""}}},setText:function(g,f){var d=this,e=function(h){f.title=g.title?g.title:h;f.caption=g.cap?g.cap:h;window.ddGM.types[b].builder.call(d,f)};if(g.title==undefined||g.cap==undefined){$.ajax({url:"https://gdata.youtube.com/feeds/api/videos/"+f.video,data:{v:2,alt:"json",fields:"title"},dataType:"json",success:function(h){e(h.entry.title.$t)},error:function(){e("")}})}else{e("")}},builder:function(e){var d=this;e.content+='<div data-type="'+b+'" class="ddGM-item '+e.id+'" style="position:absolute;width:100%;overflow:auto;top:0;left:0;">';e.content+='<div id="'+e.id+'-youtube"></div>';e.content+="</div>";d.addItem(e)},loader:function(e,g,f){var d=this,h=g.id;f.append(g.content).ready(function(){d.items[h].youtube=new window.YT.Player(h+"-youtube",{height:"100%",width:"100%",videoId:g.video,playerVars:d.opt.types[b].APIParams,events:{onReady:function(i){d.items[h].youtubeReady=true},onStateChange:function(i){window.ddGM.types[b].playerChange.call(d,i,h)}}});e.resolve()})},playerChange:function(f,g){var d=this;switch(f.data){case window.YT.PlayerState.BUFFERING:case window.YT.PlayerState.PLAYING:d.pause.call(d,"youtube");if(d.opt.types[b].playnext){d.play.call(d,"youtubePlaynext")}clearTimeout(d.timers.youtubeDelay);d.timers.youtubeDelay=false;if(d.states.controlTab&&d.opt.types[b].autoPin){window.ddGM.modules.controlTab.pin.call(d,"youtube");if(d.opt.types[b].playnext){window.ddGM.modules.controlTab.unpin.call(d,"youtubePlaynext")}}d.items[d.states.current].youtubeStarted=true;d.states.youtubeEnded=false;break;case window.YT.PlayerState.PAUSED:if(!d.timers.youtubeDelay){d.timers.youtubeDelay=setTimeout(function(){d.timers.youtubeDelay=false;if(d.states.controlTab&&d.opt.types[b].autoPin){window.ddGM.modules.controlTab.unpin.call(d,"youtube")}d.play.call(d,"youtube")},500)}break;case window.YT.PlayerState.ENDED:d.states.youtubeEnded=true;clearTimeout(d.timers.youtubeDelay);d.timers.youtubeDelay=false;if(d.states.controlTab&&d.opt.types[b].autoPin){window.ddGM.modules.controlTab.unpin.call(d,"youtube")}d.play.call(d,"youtube");if(d.opt.types[b].playnext){if(d.states.controlTab&&d.opt.types[b].autoPin){window.ddGM.modules.controlTab.pin.call(d,"youtubePlaynext")}d.pause.call(d,"youtubePlaynext");d.rotateItems.call(d,true)}break}},autoPlay:function(e){var d=this,g=d.items[d.states.current],f=function(){if(d.opt.types[b].autoPlay=="always"||(d.opt.types[b].autoPlay&&!g.youtubeStarted)||(d.opt.types[b].playnext&&d.states.youtubeEnded)){if(d.opt.types[b].playnext&&d.states.youtubeEnded){g.youtube.seekTo(0,true)}window.ddGM.types[b].play.call(d,d.states.current);d.states.youtubeEnded=false}e.resolve()};if(g.type!="youtube"){e.resolve();return}if(g.youtubeReady){f()}else{d.timers.youtubeLoading=setInterval(function(){if(g.youtubeReady){clearInterval(d.timers.youtubeLoading);f()}},100)}},changeItem:function(e){var d=this;$.each(d.items,function(g,f){window.ddGM.types[b].pause.call(d,g)});if(e!=null){e.resolve()}},play:function(f){var d=this,e=d.items[f];if(e.youtubeReady){e.youtube.playVideo()}},pause:function(f){var d=this,e=d.items[f];if(e.youtubeReady){e.youtube.pauseVideo()}}};if(!window.ddGM){window.ddGM={}}if(!window.ddGM.types){$.extend(window.ddGM,{types:{}})}window.ddGM.types[b]=c})();