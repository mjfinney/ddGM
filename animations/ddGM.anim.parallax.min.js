/* /////////////////////////////////////////////////////
 * Parallax Animation for ddGM
 * v 1.0 :: 2012-10-02
//////////////////////////////////////////////////////*/
(function(){var a="parallax",b={tiles:[],type:"horizontal",reverse:false,speed:1500,follow:12},c={initialize:function(e){var d=this;d.opt.animations[a]=$.extend(b,this.opt.animations[a]);tpl='<div class="ddGM-parallax" style="position:absolute;top:0;left:0;width:100%;height:100%">';d.obj.stage.prepend(tpl).ready(function(){d.obj.parallaxWrap=d.obj.stage.find(".ddGM-parallax");d.obj.parallaxWrap.css({"z-index":d.layers.stage});if(d.opt.animations[a].tiles.length>0){$.each(d.opt.animations[a].tiles,function(g,f){d.obj.parallaxWrap.append(tpl).children().eq(-1).css({background:"url("+f+") 0 0 repeat",zIndex:g}).data("x",0).data("y",0)});d.obj.parallax=d.obj.parallaxWrap.children();d.states.parallaxScale=1/(d.obj.parallax.length+1)}d.registerEvent("loadEnd",a,"setLayers","animation");e.resolve()})},setLayers:function(e){var d=this;d.obj.stage.find(".ddGM-item").css({zIndex:d.layers.stageBottom});e.resolve()},animate:function(e,k,h,f,g){var d=this,j=["horizontal","vertical"],i=(d.opt.animations[a].type=="random")?j[Math.round(Math.random()*j.length)-1]:d.opt.animations[a].type;h.css({"z-index":d.layers.stageBottom,display:"none"});f.css({"z-index":d.layers.stageBottom});d.deferreds.animParallax=[$.Deferred(),$.Deferred()];g=(d.opt.animations[a].reverse=="random")?Math.round(Math.random()):d.opt.animations[a].reverse?!g:g;d.obj.parallax.each(function(m){var o=$(this),q=(d.states.parallaxScale*(m+1)*d.obj.stage.width()*(g?-1:1)),n=(d.states.parallaxScale*(m+1)*d.obj.stage.height()*(g?-1:1)),l=o.data("x"),p=o.data("y");if(i=="horizontal"){n=0}else{q=0}o.data("x",l+q);o.data("y",p+n);o.stop(1,0).animate({backgroundPositionX:(l+q)+"px",backgroundPositionY:(p+n)+"px"},d.opt.animations[a].speed,"linear")});if(h!=undefined){clearTimeout(d.timers.parallax);d.timers.parallax=setTimeout(function(){window.ddGM.anims[a].animIn.call(d,d.deferreds.animParallax[0],h,i,g)},d.opt.animations[a].speed/d.opt.animations[a].follow)}else{d.deferreds.animPush[0].resolve()}if(f!=undefined){window.ddGM.anims[a].animOut.call(d,d.deferreds.animParallax[1],f,i,g)}else{d.deferreds.animParallax[1].resolve()}$.when(d.deferreds.animParallax[0],d.deferreds.animParallax[1]).done(k.resolve);e.resolve()},animIn:function(h,l,j,f){var k=this,d,m={w:k.obj.stage.width(),h:k.obj.stage.height()},g={w:l.width(),h:l.height(),x:parseInt(l.css("left"),10),y:parseInt(l.css("top"),10)},e=(k.opt.animations[a].speed/k.opt.animations[a].follow)*(k.opt.animations[a].follow-1);if(j=="horizontal"){d=f?((g.w>m.w)?m.w:(m.w+g.x)):((g.w>m.w)?(g.w*-1):(g.x-m.w));l.css({left:d,display:"block"}).animate({left:g.x},e,"linear",h.resolve)}else{d=f?(m.h+g.y):((g.y>m.h)?(g.h*-1):(g.y-m.h));l.css({top:d,display:"block"}).animate({top:g.y},e,"linear",h.resolve)}},animOut:function(h,l,j,e){var k=this,f,m={w:k.obj.stage.width(),h:k.obj.stage.height()},g={w:l.width(),h:l.height(),x:parseInt(l.css("left"),10),y:parseInt(l.css("top"),10)},d=(k.opt.animations[a].speed/k.opt.animations[a].follow)*(k.opt.animations[a].follow-1);if(j=="horizontal"){f=!e?((g.w>m.w)?m.w:(m.w+g.x)):((g.w>m.w)?(g.w*-1):(g.x-m.w));l.css({left:g.x}).animate({left:f},d,"linear",function(){$(this).css({left:g.x,opacity:0});h.resolve()})}else{f=!e?((g.h>m.h)?m.h:(m.h+g.y)):((g.y>m.h)?(g.h*-1):(g.y-m.h));l.css({top:g.y}).animate({top:f},d,"linear",function(){$(this).css({top:g.y,opacity:0});h.resolve()})}}};if(window.ddGM==undefined){window.ddGM={}}if(window.ddGM.anims==undefined){$.extend(window.ddGM,{anims:{}})}window.ddGM.anims[a]=c})();