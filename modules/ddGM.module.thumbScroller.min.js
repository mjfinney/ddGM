/* /////////////////////////////////////////////////////
 * Thumb Scroller module for ddGM
 * v 0.9 :: 2012-08-31
//////////////////////////////////////////////////////*/
(function(){var b="thumbScroller",a={toControl:true,toGallery:true,selectors:"",fit:false,fitMin:30,fitMax:150,hide:true,hideDelay:2000,slideSpeed:undefined,slideOutSpeed:375,slideInSpeed:750,showOnHover:true,showOnChange:false,scrollSpeed:500,scrollEasing:"swing",hoverScroll:true,arrowScroll:false,touchScroll:true},c={initialize:function(e){var d=this;d.opt.modules[b]=$.extend(a,d.opt.modules[b]);d.states.touchScroll=false;d.opt.modules[b].slideInSpeed=(d.opt.modules[b].slideSpeed==undefined)?d.opt.modules[b].slideInSpeed:d.opt.modules[b].slideSpeed;d.opt.modules[b].slideOutSpeed=(d.opt.modules[b].slideSpeed==undefined)?d.opt.modules[b].slideOutSpeed:d.opt.modules[b].slideSpeed;d.registerEvent("loadEnd",b,"generateThumbs");d.registerEvent("loadEnd",b,"selectThumb");d.registerEvent("midAnim",b,"selectThumb");d.registerEvent("resize",b,"sizer");d.registerEvent("unload",b,"unload");if(d.opt.modules[b].hide){d.registerEvent("loadEnd",b,"hideThumbs");if(d.opt.modules[b].showOnHover){d.registerEvent("mouseIn",b,"showThumbs");d.registerEvent("mouseOut",b,"startTimer");d.registerEvent("touchEndUp",b,"hideThumbs")}if(d.opt.modules[b].showOnChange){d.registerEvent("midAnim",b,"showThumbs");d.registerEvent("changeEnd",b,"startTimer")}}e.resolve()},generateThumbs:function(e){var d=this,g=$(),f="";f+='<div class="ddGM-thumbScroller-main" style="overflow:hidden">';if(d.opt.modules[b].arrowScroll){f+='<a class="ddGM-thumbScroller-arrow-left"><div></div></a>';f+='<a class="ddGM-thumbScroller-arrow-right"><div></div></a>'}f+='<div class="ddGM-thumbScroller-wrapper" style="position:relative;overflow:hidden">';f+='<div class="ddGM-thumbScroller" style="position:absolute;"></div>';f+="</div>";f+="</div>";if(d.opt.modules[b].toControl){g=g.add(d.obj.control)}else{if(d.opt.modules[b].toGallery){g=g.add(d.gal)}}if(d.opt.modules[b].selectors){g=g.add(d.opt.modules[b].selectors)}g.append(f).ready(function(){var i="";d.obj.thumbScrollerInternal=d.obj.control.find(".ddGM-thumbScroller-main");d.obj.thumbScrollerMain=g.find(".ddGM-thumbScroller-main");d.obj.thumbScrollerWrap=g.find(".ddGM-thumbScroller-wrapper");d.obj.thumbScroller=d.obj.thumbScrollerWrap.children(".ddGM-thumbScroller");if(!d.opt.modules[b].toControl&&d.opt.modules[b].toGallery){d.obj.thumbScrollerWrap.css({"z-index":d.layers.controls})}if(d.opt.modules[b].arrowScroll){var k=d.obj.thumbScrollerMain.find(".ddGM-thumbScroller-arrow-left"),j=d.obj.thumbScrollerMain.find(".ddGM-thumbScroller-arrow-right"),l=k.width(),h=k.height();k.children().css({"border-top-width":h/2,"border-bottom-width":h/2,"border-right-width":l});j.children().css({"border-top-width":h/2,"border-bottom-width":h/2,"border-left-width":l})}$.each(d.itemList,function(m,n){i+='<div class="ddGM-thumb-wrapper '+n+" ddGM-type-"+d.items[n].type+'"><a class="ddGM-thumb" href="#" data-item="'+n+'" style="position:relative;display:block;float:left;background-image:url('+d.items[n].thumb+');background-position:center center;background-repeat:no-repeat;" title="'+d.items[n].title+'"></a></div>'});d.obj.thumbScroller.html(i).ready(function(){var m=0;d.obj.thumbScroller.each(function(){var n=$(this);m=n.children().outerHeight(true);n.parent().css({height:m})});if(d.obj.thumbScrollerInternal.length>0){d.states.thumbScrollerHeight=d.obj.thumbScrollerInternal.height()}d.obj.thumbScroller.find("a").on("click touchend",function(n){n.preventDefault();if(!d.states.thumbScrollerScrolling&&!d.states.changing){d.states.navSource="direct";d.changeItem.call(d,null,$(this).data("item"))}});if(d.opt.modules[b].hoverScroll){window.ddGM.modules[b].hoverScroll.call(d)}if(d.opt.modules[b].arrowScroll){window.ddGM.modules[b].arrowScroll.call(d)}if(d.opt.modules[b].touchScroll){window.ddGM.modules[b].touchScroll.call(d)}window.ddGM.modules[b].sizer.call(d,e)})})},fitThumbs:function(){var d=this;d.obj.thumbScroller.each(function(){var g=$(this),f=g.children(),h=g.parent().width(),e=Math.floor((h-((f.outerWidth(true)-f.width())*f.length))/f.length);e=(e<d.opt.modules[b].fitMin)?d.opt.modules[b].fitMin:(d.opt.modules[b].fitMax===false||d.opt.modules[b].fitMax>e)?e:d.opt.modules[b].fitMax;f.css({width:e})})},sizeScroller:function(){this.obj.thumbScroller.each(function(){var f=$(this),e=f.children(),d=(e.outerWidth(true)*e.length);if(d<f.parent().width()){d="100%"}f.css({width:d,left:0})})},sizer:function(e){var d=this;if(d.opt.modules[b].fit){window.ddGM.modules[b].fitThumbs.call(d)}window.ddGM.modules[b].sizeScroller.call(d);window.ddGM.modules[b].autoScroller.call(d,d.states.current,true);window.ddGM.modules[b].arrowShow.call(d);e.resolve()},autoScroller:function(f,e){var d=this;d.obj.thumbScrollerWrap.each(function(){var m=$(this),o=m.children(),n=m.find("."+f),l=parseInt(m.width()),j=parseInt(o.position().left),h=parseInt(n.position().left),g=e?0:d.opt.modules[b].scrollSpeed,k=l-parseInt(o.width(),10),i;if((h+n.outerWidth()+j)>l){i=l-(h+n.outerWidth(true));i=(i<k)?k:(i>0)?0:i;o.stop(1,0).animate({left:i},g,d.opt.modules[b].scrollEasing,function(){window.ddGM.modules[b].arrowShow.call(d)})}else{if((h+j)<0){i=0-h;o.stop(1,0).animate({left:i},g,d.opt.modules[b].scrollEasing,function(){window.ddGM.modules[b].arrowShow.call(d)})}}})},hoverScroll:function(){var d=this;d.obj.thumbScrollerWrap.each(function(){var e=$(this);e.on("mouseenter",function(){var i=50,g=e.offset().left,h=e.width(),f=e.width()-e.children().outerWidth();g+=i;h-=(i*2);if(f<0){e.on("mousemove",function(k){var j=k.pageX-g;nL=Math.ceil((j/h)*f);nL=(nL<f)?f:(nL>0)?0:nL;e.children().css({left:nL});window.ddGM.modules[b].arrowShow.call(d)})}})});d.obj.thumbScrollerWrap.on("mouseleave",function(){d.obj.thumbScrollerWrap.off("mousemove");window.ddGM.modules[b].arrowShow.call(d)})},arrowScroll:function(){var d=this;d.obj.thumbScrollerMain.each(function(){var f=$(this),e=$(this).children(".ddGM-thumbScroller-wrapper");left=f.children(".ddGM-thumbScroller-arrow-left"),right=f.children(".ddGM-thumbScroller-arrow-right");left.on("click",function(){window.ddGM.modules[b].arrowScroller.call(d,e,1)});right.on("click",function(){window.ddGM.modules[b].arrowScroller.call(d,e,-1)})})},arrowScroller:function(g,e){var d=this,h=g.children(),f=g.width();max=f-h.outerWidth(),left=parseInt(h.css("left"),10)||0,newLeft=left+(f*e);newLeft=(newLeft>0)?0:(newLeft<max)?max:newLeft;h.animate({left:newLeft},d.opt.modules[b].scrollSpeed,d.opt.modules[b].scrollEasing,function(){window.ddGM.modules[b].arrowShow.call(d)})},arrowShow:function(){var d=this;if(d.opt.modules[b].arrowScroll){d.obj.thumbScrollerMain.each(function(){var h=$(this),f=h.find(".ddGM-thumbScroller-wrapper"),j=f.children(),e=f.width()-j.outerWidth(),i=h.find(".ddGM-thumbScroller-arrow-left"),g=h.find(".ddGM-thumbScroller-arrow-right");if(parseInt(j.css("left"),10)>=0){i.css({display:"none"})}else{i.css({display:"block"})}if(parseInt(j.css("left"),10)<=e){g.css({display:"none"})}else{g.css({display:"block"})}})}},touchScroll:function(){var d=this;d.obj.thumbScrollerWrap.each(function(){var e=$(this),f=e.children();e.on("touchstart",function(h){d.pause.call(d,"thumbScroller");if(d.opt.modules[b].hoverScroll){d.obj.thumbScrollerWrap.off("mouseenter")}max=e.width()-f.outerWidth();$(document).on("touchmove",function(k){var l=k.originalEvent;l.preventDefault()});var i=h.originalEvent,g=parseInt(e.children().css("left")),j=i.touches[0].pageX;d.states.thumbScrollerScrolling=false;clearInterval(d.timers.thumbScroller);d.timers.thumbScroller=setTimeout(function(){d.states.thumbScrollerScrolling=true},750);e.on("touchmove",function(m){var n=m.originalEvent,l=n.touches[0].pageX,k=g+(l-j);if((l+15)>Math.abs(j)){d.states.thumbScrollerScrolling=true}k=(k<max)?max:(k>0)?0:k;e.children().css({left:k})});e.on("touchend",function(k){clearInterval(d.timers.thumbScroller);$(document).off("touchmove");if(d.opt.modules[b].hoverScroll){window.ddGM.modules[b].hoverScroll.call(d)}e.off("touchmove");e.off("touchend");window.ddGM.modules[b].arrowShow.call(d);d.play.call(d,"thumbScroller")})})})},selectThumb:function(e){var d=this,f=(d.states.clicked=="")?d.states.current:d.states.clicked;d.obj.thumbScroller.children().removeClass("selected");d.obj.thumbScroller.children("."+f).addClass("selected");window.ddGM.modules[b].autoScroller.call(d,f);e.resolve()},showThumbs:function(e){var d=this;if(d.obj.thumbScrollerInternal.length>0){clearTimeout(d.timers.thumbScroller);d.obj.thumbScrollerInternal.stop(1,0).animate({height:d.states.thumbScrollerHeight},d.opt.modules[b].hideSpeed);d.states.thumbScrollerHidden=false}if(e!=null){e.resolve()}},hideThumbs:function(e){var d=this;if(d.obj.thumbScrollerInternal.length>0){d.obj.thumbScrollerInternal.stop(1,0).animate({height:0},d.opt.modules[b].hideSpeed);d.states.thumbScrollerHidden=true}if(e!=null){e.resolve()}},startTimer:function(e){var d=this;if(d.opt.modules[b].hide&&(!d.states.hover||!d.opt.modules[b].showOnHover)){clearTimeout(d.timers.thumbScroller);d.timers.thumbScroller=setTimeout(function(){window.ddGM.modules[b].hideThumbs.call(d,null)},d.opt.modules[b].hideDelay)}if(e!=null){e.resolve()}},unload:function(e){var d=this;d.obj.thumbScroller.children("a").off("click");this.obj.thumbScrollerWrap.remove();e.resolve()}};if(!window.ddGM){window.ddGM={}}if(!window.ddGM.modules){$.extend(window.ddGM,{modules:{}})}window.ddGM.modules[b]=c})();